<div class="row">
    <div class="col-xs-2 col-menu pre-scrollable">
        <div class="tree">
            <ul id="treeDemo" class="ztree" style="color:#000"></ul>
            <#--<ul class="ul-menu" id="tree-menu">-->
                <#--<li>-->
                    <#--<span><i class="glyphicon glyphicon-folder-open"></i> 首页</span>-->
                    <#--<ul>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>地图导航</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>数据概览</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>企业首页</span></li>-->
                    <#--</ul>-->
                <#--</li>-->
                <#--<li>-->
                    <#--<span><i class="glyphicon glyphicon-folder-open"></i> 基本信息</span>-->
                    <#--<ul>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>综合信息</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>基础信息</span></li>-->
                    <#--</ul>-->
                <#--</li>-->
                <#--<li>-->
                    <#--<span><i class="glyphicon glyphicon-folder-open"></i> 运营监管</span>-->
                    <#--<ul>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>预警信息</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>许可信息查询</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>许可信息录入</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>信息差异</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>运营信息</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>区域运营监管</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>服务质量</span></li>-->
                    <#--</ul>-->
                <#--</li>-->
                <#--<li>-->
                    <#--<span><i class="glyphicon glyphicon-folder-open"></i> 统计分析</span>-->
                    <#--<ul>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>运营情况统计</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>服务质量统计</span></li>-->
                    <#--</ul>-->
                <#--</li>-->
                <#--<li>-->
                    <#--<span><i class="glyphicon glyphicon-folder-open"></i> 合乘信息</span>-->
                    <#--<ul>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>私人小客车预警信息</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>私人小客车信息对比</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>行业管理部门备案</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>私人小客车平台信息</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>私人小客车合乘</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>统计分析管理</span></li>-->
                    <#--</ul>-->
                <#--</li>-->
                <#--<li>-->
                    <#--<span><i class="glyphicon glyphicon-folder-open"></i> 系统管理</span>-->
                    <#--<ul>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>部门管理</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>用户管理</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>角色管理</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>菜单管理</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>权限管理</span></li>-->
                    <#--</ul>-->
                <#--</li>-->
                <#--<li>-->
                    <#--<span><i class="glyphicon glyphicon-folder-open"></i> 车辆监控</span>-->
                    <#--<ul>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>车辆定位监控</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>车辆实时跟踪</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>历史轨迹查询</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>车辆在线率信息监控</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>车辆运营实时跟踪</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>特定区域车辆监管维护</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>电子围栏出入细腻些</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>超时驾驶信息</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>超速驾驶信息</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>电子围栏信息维护</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>异常聚集告警配置</span></li>-->
                    <#--</ul>-->
                <#--</li>-->
                <#--<li>-->
                    <#--<span><i class="glyphicon glyphicon-folder-open"></i> 网络约车审核管理</span>-->
                    <#--<ul>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>网约平台公司注册</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>网约平台信息审核</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>运营车辆信息审核</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>驾驶员信息审核</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>网约平台运价信息审核</span></li>-->
                    <#--</ul>-->
                <#--</li>-->
                <#--<li>-->
                    <#--<span><i class="glyphicon glyphicon-folder-open"></i> 稽查信息</span>-->
                    <#--<ul>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>稽查计划管理</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>异常车辆管理</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>稽查数据管理</span></li>-->
                        <#--<li><span><i class="glyphicon glyphicon-leaf"></i>稽查任务统计</span></li>-->
                    <#--</ul>-->
                <#--</li>-->
            <#--</ul>-->
        </div>
    </div>
    <div class="col-xs-10">
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">菜单管理</h3>
            </div>
            <div class="box-body">
                <div class="search">
                    <div class="label_user text-muted">
                        <label class="lead" for="search_menuName">菜单名称:</label>
                    </div>
                    <div class="user_input-group">
                        <input class="user_form-control" type="text" name="search_name" id="search_menuName"
                               placeholder="输入菜单名称...">
                    </div>
                    <div class="label_user text-muted">
                        <label class="lead" for="search_menuType">菜单类型:</label>
                    </div>
                    <div class="user_input-group">
                        <select class="user_form-control " name="search_menuType" id="search_menuType"
                                placeholder="选择所在组织...">
                            <option value="1">系统菜单</option>
                            <option value="2">业务菜单</option>
                            <option value="3">CURD</option>
                        </select>
                    </div>
                    <div class="operate">
                        <a class="btn btn-xs btn-primary">查&nbsp;&nbsp;询</a>
                    </div>
                    <div class="operate">
                        <a onclick="" class="btn btn-primary btn-xs" disabled="disabled"
                        >添&nbsp;&nbsp;加</a>
                    </div>
                    <div class="operate">
                    <#--id=所选中的数据id 待添加-->
                        <a class="btn btn-xs btn-primary" href="/macoo/admin/role/delete?id=?" target="ajaxTodo"
                           callback="roleReload();" data-body="确认要删除吗？">删&nbsp;&nbsp;除</a>
                    </div>
                </div>
                <table id="menu_tab" class="table table-bordered table-striped">
                    <thead>
                    <tr>
                    <tr>
                        <th>选择</th>
                        <th>序号</th>
                        <th>菜单名称</th>
                        <th>菜单类型</th>
                        <th>上级菜单</th>
                        <th>是否可用</th>
                        <th>图标</th>
                        <th>展开状态</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                </table>
                <div class="operate">
                    <a class="btn btn-xs btn-primary" id="fullChose" onclick="fullChose()">全选</a>
                    <a class="btn btn-xs btn-primary" id="revChose" onclick="revChose()">反选</a>
                    <a class="btn btn-xs btn-primary" id="unChose" onclick="unChose()">取消选择</a>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    var menu_tab;
    $(function () {
        //初始化时间选择器
        $('#menuTime').datepicker({
            language: 'zh-CN',
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayHighlight: true
        });
        //初始化表格
        var No = 0;
        menu_tab = $('#menu_tab').DataTable({
            "dom": 'itflp',
            "processing": true,
            "searching": false,
            "serverSide": true, //启用服务器端分页
            "bInfo": false,
            "language": {"url": "plugins/datatables/language.json"},
            "ajax": {"url": "${ctx}/admin/menu/page", "type": "post"},
            "columns": [
                {"data": null},//选择
                {"data": null},//序号
                {"data": "menuName"},//菜单名称
                {"data": null},//菜单类型 menuType
                {"data": "parentId"},//上级菜单
                {"data": null},//是否可用 enable
                {"data": "iconcls"},//图标
                {"data": null},//展开状态 expand
                {"data": null}//操作
            ],
            "columnDefs": [
//                复选框
                {
                    targets: 0,
                    data: null,
                    render: function (data) {
                        var ckBox = "";
                        ckBox = '<input type="checkbox" class="user_checkbox"  name="items" value=' + data.id + '>';
                        return ckBox;
                    }
                },
//                    序号
                {
                    targets: 1,
                    data: null,
                    render: function (data) {
                        No = No + 1;
                        return No;
                    }
                },
//                    菜单类型
                {
                    targets: 3,
                    data: null,
                    render: function (data) {
                        if (data.menuType == "0") {
                            return "CURD";
                        }
                        if (data.menuType == "1") {
                            return "系统菜单";
                        }
                        if (data.menuType == "2") {
                            return "业务菜单";
                        }
                        return "未知类型";
                    }
                },
//                   上级菜单
                /*    {

                        }
                    },*/
//                    是否可用 enable
                {
                    targets: 5,
                    data: null,
                    render: function (data) {
                        if (data.enable == "0") {
                            return "锁定";
                        }
                        if (data.enable == "1") {
                            return "激活";
                        }
                        return "未知状态";
                    }
                },
//                    展开状态
                {
                    targets: 8,
                    data: null,
                    render: function (data) {
                        if (data.expand == "0") {
                            return "收起";
                        }
                        if (data.expand == "1") {
                            return "展开";
                        }
                        return "未知状态";
                    }
                },
//                    操作
                {
                    "targets": -1,
                    "data": null,
                    "render": function (data) {
                        var btn = "";
                        if (data.roleValue != 'super') {
                            btn = '<a class="btn btn-xs btn-primary " target="modal"  href="${ctx}/admin/menu/view?id='
                                    + data.id + '">查看</a> &nbsp;'
                                    + '<@shiro.hasPermission name="super:update">'
                                    + '<a class="btn btn-xs btn-info" onclick="menuToListAjax();" target="modal" ' +
                                    ' href="${ctx}/admin/menu/edit?id='+ data.id+ '">修改</a> &nbsp;'
                                    +'</@shiro.hasPermission>'
                                    + '<@shiro.hasPermission name="super:delete">'
                                    + '<a class="btn btn-xs btn-default" callback="menuReload();" data-body="确认要删除吗？" ' +
                                    'target="ajaxTodo" href="${ctx}/admin/menu/delete?id='+ data.id + '">删除</a>'
                                    +'</@shiro.hasPermission>';
                        }
                        return btn;
                    }
                }]
        }).on('preXhr.dt', function (e, settings, data) {
            console.log(data, settings)
            No = 0;
        });
    });
    //待添加
    function menuReload() {
        reloadTable(menu_tab, "", "");
    }
    function menuToListAjax() {
        list_ajax = menu_tab;
        console.log(list_ajax);
    }
</script>
<#--菜单树结构-->
<script>
    $(function () {
        $('.tree > ul >li >ul li').hide();
        $('.tree li:has(ul)').addClass('parent_li').find(' > span').attr('title', 'Collapse this branch');
        $('.tree li.parent_li > span').on('click', function (e) {
            var children = $(this).parent('li.parent_li').find(' > ul > li');
            if (children.is(":visible")) {
                $('.tree > ul >li >ul li').hide();
                children.hide('fast');
                $(this).attr('title', 'Expand this branch').find(' > i').addClass('icon-plus-sign').removeClass('icon-minus-sign');
            } else {
                $('.tree > ul >li >ul li').hide();
                children.show('fast');
                $(this).attr('title', 'Collapse this branch').find(' > i').addClass('icon-minus-sign').removeClass('icon-plus-sign');
            }
            e.stopPropagation();
        });
    });

</script>


<!-- 树，注意：chrome下只有将引用放在这里才正确显示树 -->
<link rel="stylesheet" href="zTree/css/zTreeStyle/zTreeStyle.css" type="text/css">
<script type="text/javascript" src="zTree/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="zTree/js/jquery.ztree.core-3.5.js"></script>

<script>

//    获取到所有一级菜单项
    <#--$(function(){-->
        <#--$.get(-->
                <#--"${ctx}/admin/menu/queryForParentId",-->
                <#--{parentId: 1},-->
                <#--function(data){-->
                    <#--var str = "";-->
                    <#--$.each(data, function(index, obj) {-->
                        <#--str += index + ":" + obj.menuName;-->
                    <#--});-->
                    <#--alertMsg(str);-->
                <#--}-->
        <#--);-->
    <#--});-->


    var zTreeObj;
    // zTree 的参数配置，深入使用请参考 API 文档（setting 配置详解）
    var setting = {
        check: {
            enable: true,
            chkStyle: "radio",
            radioType: "all"
        },
        view: {
            dblClickExpand: false
        },
        data: {
            simpleData: {
                enable: true
            }
        },
        callback: {
//            onClick: onClickNode,
//            onCheck: onCheck
        }
    };

//    显示undefined树 只有一级
    <#--$(function(){-->
        <#--$.get(-->
                <#--"${ctx}/admin/menu/queryForParentId",-->
                <#--{parentId: 1},-->
                <#--function(data){-->
                    <#--$.fn.zTree.init($("#treeDemo"), setting, data);-->
                <#--}-->
        <#--);-->
    <#--});-->

var setting = {
    async:{
        autoParam:["parentId"],
        enable:true,
        type:"post",
        url:getUrl,
        dataFilter:filter,
    },
    check : {
        chkStyle: "radio",
        enable: false,
        checkboxType : { "Y" : "s", "N" : "ps" },
        radioType : "level"
    },
    view: {
        dblClickExpand: false,
        addDiyDom:addDiyDom
    },
    data : {
        key : {
            name : "menuName"
        },
        simpleData : {
            enable : true,
            idKey : "id",
            pIdKey : "parentId",
            rootPId : 0
        }
    },
    callback : {
//        beforeAsync : ztreeBeforeAsync,
        onAsyncSuccess : ztreeOnAsyncSuccess,
        onClick:ztreeOnAsyncSuccess
    }
};
$.fn.zTree.init($("#treeDemo"), setting);
function ztreeOnAsyncSuccess(event, treeId, treeNode){
        var url = "${ctx}/admin/menu/queryForParentId?parentId=";

        if(treeNode == undefined){
            url += "1";
        }
        else{
            url += treeNode.id;
        }
        <#--var url = "${ctx}/admin/menu/page";-->
        $.ajax({
            type : "post",
            url : url,
            data : "",
            dataType : "json",
            async : true,
            success : function(jsonData) {
                if (jsonData != null) {
                    $.each(jsonData, function(index, obj) {
                        alert(obj.name);
                        if(data != null && data.length != 0){
                            if(treeNode == undefined){
                                treeObj.addNodes(null,data,true);// 如果是根节点，那么就在null后面加载数据
                            }
                            else{
                                treeObj.addNodes(treeNode,data,true);//如果是加载子节点，那么就是父节点下面加载
                            }
                        }
                        treeObj.expandNode(treeNode,true, false, false);// 将新获取的子节点展开
                    });

                }
            },
            error : function() {
                alert("请求错误！");
            }
        });

    };

    <#--// zTree 的数据属性，深入使用请参考 API 文档（zTreeNode 节点数据详解）-->
    <#--var zNodes = [-->
        <#--{ id: 1, pId: 0, name: "父节点1", open: true },-->
        <#--{ id: 11, pId: 1, name: "父节点11" },-->
        <#--{ id: 111, pId: 11, name: "叶子节点111" },-->
        <#--{ id: 112, pId: 11, name: "叶子节点112" },-->
        <#--{ id: 113, pId: 11, name: "叶子节点113" },-->
        <#--{ id: 114, pId: 11, name: "叶子节点114" },-->
        <#--{ id: 12, pId: 1, name: "父节点12" },-->
        <#--{ id: 121, pId: 12, name: "叶子节点121" },-->
        <#--{ id: 122, pId: 12, name: "叶子节点122" },-->
        <#--{ id: 123, pId: 12, name: "叶子节点123" },-->
        <#--{ id: 124, pId: 12, name: "叶子节点124" },-->
        <#--{ id: 13, pId: 1, name: "父节点13", isParent: true },-->
        <#--{ id: 2, pId: 0, name: "父节点2" },-->
        <#--{ id: 21, pId: 2, name: "父节点21", open: true },-->
        <#--{ id: 211, pId: 21, name: "叶子节点211" },-->
        <#--{ id: 212, pId: 21, name: "叶子节点212" },-->
        <#--{ id: 213, pId: 21, name: "叶子节点213" },-->
        <#--{ id: 214, pId: 21, name: "叶子节点214" },-->
        <#--{ id: 22, pId: 2, name: "父节点22" },-->
        <#--{ id: 221, pId: 22, name: "叶子节点221" },-->
        <#--{ id: 222, pId: 22, name: "叶子节点222" },-->
        <#--{ id: 223, pId: 22, name: "叶子节点223" },-->
        <#--{ id: 224, pId: 22, name: "叶子节点224" },-->
        <#--{ id: 23, pId: 2, name: "父节点23" },-->
        <#--{ id: 231, pId: 23, name: "叶子节点231" },-->
        <#--{ id: 232, pId: 23, name: "叶子节点232" },-->
        <#--{ id: 233, pId: 23, name: "叶子节点233" },-->
        <#--{ id: 234, pId: 23, name: "叶子节点234" },-->
        <#--{ id: 3, pId: 0, name: "父节点3", isParent: true }-->
    <#--];-->

    <#--zTreeObj = $.fn.zTree.init($("#treeDemo"), setting);-->

    <#--//节点点击事件-->
    <#--function onClickNode(e, treeId, treeNode) {-->
        <#--var zTree = $.fn.zTree.getZTreeObj("treeDemo");-->
        <#--zTree.checkNode(treeNode, !treeNode.checked, null, true);-->
        <#--return false;-->
    <#--}-->

    <#--//节点选择事件-->
    <#--function onCheck(e, treeId, treeNode) {-->
        <#--var zTree = $.fn.zTree.getZTreeObj("treeDemo"),-->
                <#--nodes = zTree.getCheckedNodes(true),-->
                <#--v = "";-->
        <#--var parentid = "";-->
        <#--var parentlevel = "";-->
        <#--for (var i = 0, l = nodes.length; i < l; i++) {-->
            <#--v += nodes[i].name + ",";-->
            <#--parentid += nodes[i].id + ",";-->
            <#--parentlevel += nodes[i].menu_level + ",";-->
        <#--}-->
        <#--if (v.length > 0) {-->
            <#--v = v.substring(0, v.length - 1);-->
            <#--parentid = parentid.substring(0, parentid.length - 1);-->
            <#--parentlevel = parentlevel.substring(0, parentlevel.length - 1);-->
        <#--}-->
        <#--else {-->
            <#--return;-->
        <#--}-->
    <#--}-->

    <#--$(function() {-->
        <#--var treeNodes;-->
        <#--$.ajax({-->
            <#--async : false,-->
            <#--cache:false,-->
            <#--type: 'POST',-->
            <#--dataType: 'json'-->
<#--//            contentType:"application/json",-->
            <#--url: "${ctx}/admin/menu/page",//请求的action路径-->
            <#--error: function () {//请求失败处理函数-->
                <#--alert('获取树内容失败');-->
            <#--},-->
            <#--success:function(data){ //请求成功后处理函数。-->
                <#--data = "[" + data + "]";-->
                <#--treeNodes = eval(data);-->
                <#--$.each(function(index, value){-->
                    <#--alertMsg(index);-->
                <#--})-->
            <#--}-->
        <#--});-->
        <#--$.fn.zTree.init($("#treeDemo"), treeNodes);-->
    <#--});-->


</script>